
<h2>[[Attach File]]</h2>

<form id="uploadform" name="wizard" method="post" enctype="multipart/form-data" action="$home$apphome${page.uploadroot}/uploadfile-finish.html" >
<input type="hidden" name="origURL" value="$apphome/assets/${asset.sourcePath}.html" />	
#set( $path = $context.getRequestParameter('editPath') )	
#if( !$path)
#set( $path = $context.getRequestParameter('path') )
#end
#set( $target = $pageManager.getPage($path))
#if( !$target.isFolder() )	
#set ($path = $target.getParentPath())
#end

<div id="alluploadfiles">
$pages.include("$apphome${page.uploadroot}/uploadfield.html")
</div>

<input type="hidden" id="path" name="path" value="$apphome/data/originals/$asset.sourcePath" size="35" />
<input type="hidden" id="assetid" name="assetid" value="$!asset.id"/>
<p>
<input type="button" id="finishbutton" name="Finish" value="Upload" onclick="doUpload( 'uploadform' );">

##This div is important. AJAX replaces it.
<div id="waiting">
</div>
</p>

<script type="text/javascript" >
	
	doUpload =  function( inForm )
	{
		form = document.getElementById(inForm);
		if ( form == null )
		{
			alert("[[No form found]]");
			alert( "[[see]]:" + form );
		}
		form.target = "_self";
		var finishButton = document.getElementById('finishbutton');
		if (finishButton != null)
		{
			finishButton.disabled = true;
		}
		new Insertion.Bottom('waiting', "<div><img src='$home/system/images/toolbar/spinner.gif'/><br/>[[Uploading, please wait...]]</div>");
		form.submit();
	}

	SetPath =  function( inUrl )
	{
		var input = document.getElementById("path");
		input.value = inUrl;
	}
	
</script>


</form>
