

$context.putPageValue("assetrootfolder", "/$catalogid/assets")

$context.putPageValue("showtoolbar", "false")

#if( !$thumbsize )
    #set( $thumbsize  = "medium" ) 
#end

#set($loop = $hits)
#ifnotnull($lightboxassets)
	#set($loop = $lightboxassets)
	#set( $hits = $assethits )
	$context.putPageValue("hits",$hits)
#end

<div id="resultsdiv" class="resultsdiv scroll-resultsdiv"
	data-hitssessionid="$!hits.getSessionId()" ##it breaks drag&drop
	data-hitsname="$!hits.getHitsName()"
	data-componenthome="$!componenthome"
	data-searchhome="$!home$!{componenthome}/results"
	data-category="$!category.getId()"
	data-collectionid="$!librarycol.getId()" 
	data-publishingid="$!publishingid"
	data-rendertype="$!rendertype"
	data-searchtype="asset" 
	data-pagenum="$!hits.getPage()" 
	data-totalpages="$!hits.getTotalPages()"
	data-module="$!module"
	data-section="$!content.section"
	#set( $inputid = $context.getRequestParameter("inputid"))
	data-inputid="$!inputid"
	data-ismaingrid="true"
	data-stackedviewpath="/$!mediadbappid/services/module/asset/players/collections/display/brickviewassets.html">


	#if( $hideheader &&  $hideheader != "true")
		$pages.include("$componenthome/results/header.html",$context) 
	#end
		<div class="masonry-grid2 masonry-grid-cells" 
			data-maxheight="180" 
			data-maxwidth="180"
			data-targeth="180"
			data-cellpadding="4">
		
		#set($count = 0)
		#set($viewerlink = $content.get("assetviewerlink") )
		#set($stackedfield = $mediaarchive.getCatalogSettingValue("stackedgalleryfield"))
		
		#foreach( $brick in $loop.getPageOfHits())
		 
		 	#ifnotnull( $hitassetlookup )
			 	#set( $hit = $hitassetlookup.get($brick.getId()) )
		 	#end
		 	#ifnull( $hitassetlookup )
				#set( $hit = $brick)
		 	#end
			$context.putPageValue("brick", $brick)
			$context.putPageValue("hit", $hit)
			$context.putPageValue("asset", $hit)
			
			#set($type = $hit.getSearchHit().getType())
			#set($rendertype = $mediaarchive.getMediaRenderType($hit.fileformat))
			
			$context.putPageValue("assetid", $hit.id)
			$context.putPageValue("count", $count )
			$context.putPageValue("sourcepath", $hit.sourcepath )
			$context.putPageValue("thumbsize", "mediumplus" )
			
			#set($sourcepath = $hit.sourcepath)
			#set($assetwidth = $mediaarchive.getRealImageWidth($hit))
			#set($assetheight = $mediaarchive.getRealImageHeight($hit))
			#set($click = "$siteroot$viewerlink?hitssessionid=${hits.getSessionId()}&assetid=$!{hit.id}")
			#set($isselected = $!hits.isSelectedOnPage($!{hit.id}) )
		       
			<div class="masonry-grid-cell" 
				id="gallerycell_$!{hit.id}"
				data-assetid="$!{hit.id}"
				#if($rendertype == "audio")
					data-width="250"
					data-height="110"
				#else
					data-width="$assetwidth"
					data-height="$assetheight"
					$context.putPageValue("thumbheight", "180" ) 
				#end
				>
				<div class="grid-cell-hover"></div>
				##<div class="grid-gallery-checked"></div>
				#if(!$rendertype || $type =="rendertype")
					#set( $rendertype = "mime" )
				#elseif( $rendertype =="video" || $rendertype =="documentX")
					#set( $rendertype = "image" )
				#end
				$context.putPageValue("rendertype", $rendertype)

				#set($sourcepath = $hit.sourcepath)
				$context.putPageValue("sourcepath", $hit.sourcepath )

				#set($convertpreset = $mediaarchive.getCachedData("convertpreset", "largeimage" ) )
				#if($rendertype =="document")
				#set($convertpreset = $mediaarchive.getCachedData("convertpreset", "0" ) )
				#end
				#set($downloadlink = $mediaarchive.asLinkToDownload($hit, $convertpreset))
				$context.putPageValue("downloadlink", $downloadlink)
				
				<div class="grid-thumbimage " data-assetid="$!hit.id" data-rendertype="$!rendertype">
					$pages.include("$componenthome/results/thumbnails/brickstatic.html", $context)
				</div>
				
				<div class="grid-cell-footer"><a class="downloadicon" href="${downloadlink}" title="[[Download]] $!hit.getName()"><span>[[Download]]</span></a></div>
			    
			</div>
		    #set ( $count = $count + 1) 
		#end
		
	</div>
</div>

#if ( $hits.totalPages == 0 )
	<p class="info" style="margin: 20px;">
	[[No results found.]]
	</p>
#end


<script type="text/javascript">
		/**
		 * Init
		 */
		(function ($) {
			jQuery(document).ready(function () {
			    var grid = $(".masonry-grid2");
				grid.brickvertical();
				
				$('.lightbox').simpleLightbox();
			});
		}(jQuery));		
		</script>
