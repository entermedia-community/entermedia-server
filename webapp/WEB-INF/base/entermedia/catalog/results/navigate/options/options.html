<h2>Result Layout</h2>
<form name="save" target="_parent" cellspacing="10" action="$home${cataloghome}/results/navigate/options/save.html">
	<input type="hidden" name="hitssessionid" value="$hits.sessionId"/>
	<input id="redirecturlinput" type="hidden" name="origURL" />
	#set( $resulttype = $context.getRequestParameter("resulttype") )
	#if( !$resulttype )
		#set( $resulttype = "asset")
	#end
	<input type="hidden" name="oldresulttype" value='$resulttype'/>
	<input type="hidden" name="resulttype" value="$resulttype" />
	
	<table style="text-align:left;">
	<tr>
		<td>[[View]]</td>
		<td>
			#set($currentsetting = false)
			#set($currentsetting = $usersettings.getViewForResultType($resulttype))
			<select name="newresultview" >
				#foreach( $type in $searcherManager.getList($catalogid, "resulttype"))
					<option value="$type.id" #if($type.id == $currentsetting ) selected #end>$type</option>
				#end
			</select>
		</td>
	</tr>
	<tr>	
		<td>[[Sort]]</td>
		<td>
			<select name="sortby">
				<option value=""></option>
				#set($assetsearcher = $searcherManager.getSearcher($catalogid, "asset"))
				#set( $ordering = $usersettings.getSortForSearchType($resulttype))
				#foreach( $searchItem in $assetsearcher.getDetailsForView("asset/orderby", $user) )
					#if( $searchItem.isDate() )
						<option value="${searchItem.getId()}Down" #if(  $ordering == "${searchItem.getId()}Down" ) selected #end >${searchItem.getText($context)} [[[Newer First]]]</option>
						<option value="${searchItem.getId()}Up" #if(  $ordering == "${searchItem.getId()}Up" ) selected #end >${searchItem.getText($context)} [[[Newer Last]]]</option>
					#else
						<option value="${searchItem.getId()}Up" #if( $ordering == "${searchItem.getId()}Up" ) selected #end >${searchItem.getText($context)} [[[A-Z]]]</option>
						<option value="${searchItem.getId()}Down" #if( $ordering == "${searchItem.getId()}Down" ) selected #end >${searchItem.getText($context)} [[[Z-A]]]</option>
					#end
				#end
				<option value="random" #if( $hits.getOrdering() && $hits.getOrdering() == "random" ) selected #end >[[Random]]</option>			
			</select> 
		</td>
	</tr>
	<tr>	
		<td>[[Hits Per Page]]</td>
		<td>
			#set($hitsperpage = $usersettings.getHitsPerPageForSearchType($resulttype))
			<select name="hitsperpage">
				#foreach( $item in $searcherManager.getList($catalogid, "hitcount"))
					<option value="$item.id" #if( $item.id == "$hitsperpage" ) selected #end>$item</option>
				#end
			</select>
	    </td>
	</tr>
	<tr>
	<td></td>
	<td style="padding-top:10px;">
		##when it saves it will blow away old custom settings
		<input type="submit" value="Save" />
	</td>
	</tr>
</form>

<script type="text/javascript">
	var parentloc = parent.window.location.href;
	//strip off everything after a hash including the hash
	var hashIndex = parentloc.indexOf("#");
	if(hashIndex != -1)
	{
		parentloc = parentloc.substring(0, parentloc.indexOf("#"));
	}
	if(parentloc.indexOf("?") == -1)
	{
		jQuery("#redirecturlinput").attr("value", parentloc + "?hitssessionid=hits${applicationid}");
	}
	else
	{
		jQuery("#redirecturlinput").attr("value", parentloc);
	}
</script>